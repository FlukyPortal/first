<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/media/file.svg">
    <title>Fluky Verification</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script defer src="https://vercel.live/_analytics/script.js"></script>
    <style>
        body {
            background-color: #111;
            color: #e5e5e5;
            font-family: 'Inter', sans-serif;
        }

        .zin-bg {
            background: radial-gradient(circle at 50% 50%, #222, #000);
        }

        .task-card {
            background: linear-gradient(145deg, #1a1a1a, #222);
            border: 1px solid #333;
            transition: all 0.3s ease;
        }

        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .verification-box {
            border: 2px dashed #444;
            background-color: #1a1a1a;
        }

        .countdown {
            color: #888;
        }

        .creepy-text {
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
            letter-spacing: 2px;
        }

        .hidden-data {
            display: none;
        }

        .fluky-logo {
            letter-spacing: 0.2em;
            font-weight: 300;
        }

        .terminal-line {
            position: relative;
            padding-left: 1.5em;
            color: #999;
        }

        .terminal-line::before {
            content: ">";
            position: absolute;
            left: 0;
            color: #666;
        }

        .google-btn {
            width: 100%;
            background: white;
            color: black;
            border-radius: 4px;
            padding: 10px 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .google-btn:hover {
            background: #e5e5e5;
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 16px 0;
            color: #666;
        }

        .divider::before,
        .divider::after {
            content: "";
            flex: 1;
            border-bottom: 1px solid #333;
        }

        .divider::before {
            margin-right: 16px;
        }

        .divider::after {
            margin-left: 16px;
        }

        .channel-link {
            color: #00a2ff;
            text-decoration: underline;
            cursor: pointer;
        }
    </style>
</head>

<body class="zin-bg min-h-screen">
    <!-- Hidden data storage -->
    <div class="hidden-data" id="userData"></div>
    <div class="hidden-data" id="taskData"></div>

    <!-- Auth Container -->
    <div class="container mx-auto px-4 py-16 max-w-md" id="authContainer">
        <div class="bg-black p-8 rounded-lg shadow-2xl border border-gray-800">
            <h1 class="text-4xl font-light text-center mb-2 text-white fluky-logo">FLUKY</h1>
            <p class="text-center text-gray-500 mb-8 terminal-line">VERIFICATION PORTAL v3.1.4</p>

            <!-- Login Form -->
            <div id="loginForm">
                <div id="g_id_onload"
                    data-client_id="48508544336-ffr2pdtvlbr0tu93g2eta82ggtk2gtth.apps.googleusercontent.com"
                    data-context="signin" data-ux_mode="popup" data-callback="handleGoogleSignIn"
                    data-auto_prompt="false">
                </div>

                <div class="google-btn" id="googleSignInBtn" onclick="googleSignIn()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
                        <path fill="#4285F4"
                            d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                        <path fill="#34A853"
                            d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                        <path fill="#FBBC05"
                            d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                        <path fill="#EA4335"
                            d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                        <path fill="none" d="M1 1h22v22H1z" />
                    </svg>
                    Continue with Google
                </div>

                <div class="divider">
                    OR
                </div>

                <h2 class="text-xl font-semibold mb-6 text-gray-300">SIGN IN</h2>
                <div class="mb-4">
                    <label class="block text-gray-400 mb-2">EMAIL</label>
                    <input type="email" id="loginEmail"
                        class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded focus:outline-none focus:border-gray-500 text-white">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-400 mb-2">PASSWORD</label>
                    <input type="password" id="loginPassword"
                        class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded focus:outline-none focus:border-gray-500 text-white">
                </div>
                <button onclick="login()"
                    class="w-full bg-white text-black py-2 px-4 rounded font-bold hover:bg-gray-200 transition duration-200 mb-4">ENTER</button>
                <p class="text-gray-500 text-center">NO ACCOUNT? <span onclick="showSignup()"
                        class="text-white cursor-pointer hover:underline">REGISTER</span></p>
            </div>

            <!-- Signup Form -->
            <div id="signupForm" class="hidden">
                <div class="google-btn" onclick="googleSignIn()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
                        <path fill="#4285F4"
                            d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                        <path fill="#34A853"
                            d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                        <path fill="#FBBC05"
                            d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                        <path fill="#EA4335"
                            d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                        <path fill="none" d="M1 1h22v22H1z" />
                    </svg>
                    Continue with Google
                </div>

                <div class="divider">
                    OR
                </div>

                <h2 class="text-xl font-semibold mb-6 text-gray-300">REGISTER</h2>
                <div class="mb-4">
                    <label class="block text-gray-400 mb-2">EMAIL</label>
                    <input type="email" id="signupEmail"
                        class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded focus:outline-none focus:border-gray-500 text-white">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-400 mb-2">PASSWORD</label>
                    <input type="password" id="signupPassword"
                        class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded focus:outline-none focus:border-gray-500 text-white">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-400 mb-2">CONFIRM PASSWORD</label>
                    <input type="password" id="signupConfirmPassword"
                        class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded focus:outline-none focus:border-gray-500 text-white">
                </div>
                <button onclick="signup()"
                    class="w-full bg-white text-black py-2 px-4 rounded font-bold hover:bg-gray-200 transition duration-200 mb-4">CREATE
                    ACCOUNT</button>
                <p class="text-gray-500 text-center">ALREADY HAVE AN ACCOUNT? <span onclick="showLogin()"
                        class="text-white cursor-pointer hover:underline">SIGN IN</span></p>
            </div>
        </div>
    </div>

    <!-- Dashboard Container -->
    <div class="container mx-auto px-4 py-8 hidden" id="dashboardContainer">
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-2xl font-light text-white fluky-logo">FLUKY</h1>
                <p class="text-gray-400 terminal-line">USER: <span id="currentUserEmail"
                        class="text-white">user@example.com</span></p>
                <p class="text-gray-400 terminal-line hidden" id="googleUserBadge">GOOGLE ACCOUNT</p>
            </div>
            <button onclick="logout()"
                class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded">LOGOUT</button>
        </div>

        <div class="mb-8">
            <div class="bg-black p-4 rounded-lg border border-gray-800">
                <h2 class="text-xl font-semibold mb-2 text-white">STATUS</h2>
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-400">Tasks Completed: <span id="completedTasks"
                                class="text-white">0</span>/4</p>
                    </div>
                    <div id="statusBadge" class="bg-gray-800 text-white px-3 py-1 rounded-full text-sm">
                        ACTIVE
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasks Container -->
        <div id="tasksContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Tasks will be dynamically inserted here -->
        </div>

        <!-- Verification Modal -->
        <div id="verificationModal"
            class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50">
            <div class="bg-black p-6 rounded-lg border border-gray-800 max-w-md w-full">
                <h3 class="text-xl font-bold mb-4 text-white" id="verificationTaskTitle">VERIFY TASK</h3>
                <p class="text-gray-400 mb-4" id="verificationInstructions">Please complete the task first:</p>
                <a id="channelLink" target="_blank" class="channel-link mb-4 block">Click here to go to the channel</a>
                <div class="verification-box rounded-lg p-4 mb-4 flex justify-center">
                    <img id="verificationImagePreview" src="" alt="Verification Image" class="max-h-64 hidden">
                    <p id="verificationPlaceholder" class="text-gray-500 text-center py-8">NO IMAGE SELECTED</p>
                </div>
                <input type="file" id="verificationImageInput" accept="image/*" class="hidden">
                <button onclick="document.getElementById('verificationImageInput').click()"
                    class="w-full bg-gray-800 hover:bg-gray-700 text-white py-2 px-4 rounded mb-4">SELECT IMAGE</button>
                <div class="countdown text-center mb-4 hidden" id="countdown">VERIFYING IN: <span
                        id="countdownValue">10</span>s</div>
                <button id="verifyButton" onclick="startVerification()"
                    class="w-full bg-white text-black py-2 px-4 rounded font-bold hover:bg-gray-200 transition duration-200">VERIFY</button>
                <button onclick="cancelVerification()"
                    class="w-full bg-gray-800 hover:bg-gray-700 text-white py-2 px-4 rounded mt-2">CANCEL</button>
            </div>
        </div>

        <!-- Completion Modal -->
        <div id="completionModal"
            class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center hidden z-50 backdrop-blur-sm">
            <div
                class="bg-gradient-to-br from-gray-900 to-black p-8 rounded-lg border-2 border-gray max-w-md w-full text-center shadow-lg shadow-gray/20">
                <!-- Title with creepy animation -->
                <h3 class="text-3xl font-bold mb-6 text-gray creepy-text animate-pulse"
                    style="text-shadow: 0 0 8px #ffff;">
                    PROCESSING COMPLETE
                </h3>

                <p class="text-gray-400 mb-6 tracking-widest">ALL TASKS HAVE BEEN VERIFIED</p>

                <!-- Creepy eligible replacement -->
                <p class="text-2xl font-bold text-gray mb-6 creepy-text" style="text-shadow: 0 0 5px #ffffff;">
                    YOU HAVE BEEN CHOSEN
                </p>

                <!-- Link box with copy button -->
                <div class="mb-6">
                    <div class="flex items-center bg-gray-800 rounded-md overflow-hidden border border-gray">
                        <input type="text" id="creepyLink" value="https://flukz.vercel.app"
                            class="flex-grow px-4 py-2 bg-transparent text-gray-300 font-mono text-sm truncate"
                            readonly>
                        <button id="copyButton"
                            class="bg-white hover:bg-gray-700 px-4 py-2 text-black font-bold transition-colors">
                            COPY
                        </button>
                    </div>
                </div>

                <!-- Bottom text with creepy effect -->
                <p class="text-gray-600 text-xs tracking-wider creepy-text" id="revokedText">
                    YOUR ACCESS HAS BEEN PERMANENTLY REVOKED
                </p>
            </div>
        </div>

        <!-- Add this script for the creepy effects -->
        <script>
            document.getElementById('copyButton').addEventListener('click', function () {
                // Copy the link
                const link = document.getElementById('creepyLink');
                link.select();
                document.execCommand('copy');

                // Show creepy confirmation
                const originalText = this.textContent;
                this.textContent = 'COPIED...';
                this.classList.add('bg-white');

                // Create creepy floating text
                const creepyAlert = document.createElement('div');
                creepyAlert.textContent = `LINK COPIED: ${link.value}`;
                creepyAlert.className = 'fixed text-bg-grayfont-mono text-sm creepy-text animate-float';
                creepyAlert.style.left = `${Math.random() * window.innerWidth}px`;
                creepyAlert.style.top = `${Math.random() * window.innerHeight}px`;
                document.body.appendChild(creepyAlert);

                // Remove after animation
                setTimeout(() => {
                    creepyAlert.remove();
                    this.textContent = originalText;
                    this.classList.remove('bg-gray');
                }, 2000);
            });
        </script>
    </div>

    <script>
        // Social Media Channel URLs
        const CHANNEL_URLS = {
            1: "https://www.youtube.com/channel/UCdBFQKUVewkE25jZBcGdMFA", // Replace with your YouTube channel URL
            2: "https://x.com/Fluky_Official", // Replace with your Twitter/X URL
            4: "https://www.instagram.com/fluky_portal_official?igsh=MXcwN3RxMzQ1cXA5&utm_source=qr", // Replace with your Instagram URL
            5: "https://www.facebook.com/profile.php?id=61578698795778"  // Replace with your Facebook page URL
        };

        // Initialize data structures
        if (!localStorage.getItem('users')) {
            localStorage.setItem('users', JSON.stringify([]));
        }
        if (!localStorage.getItem('tasks')) {
            const defaultTasks = [
                { id: 1, title: "FOLLOW ON YOUTUBE", description: "Subscribe to our YouTube channel and verify", completed: false, verified: false, image: null },
                { id: 2, title: "FOLLOW ON TWITTER", description: "Follow us on Twitter/X and verify", completed: false, verified: false, image: null },
                { id: 4, title: "FOLLOW ON INSTAGRAM", description: "Follow us on Instagram and verify", completed: false, verified: false, image: null },
                { id: 5, title: "LIKE FACEBOOK PAGE", description: "Like our Facebook page and verify", completed: false, verified: false, image: null }
            ];
            localStorage.setItem('tasks', JSON.stringify(defaultTasks));
        }

        // DOM elements
        const authContainer = document.getElementById('authContainer');
        const dashboardContainer = document.getElementById('dashboardContainer');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const tasksContainer = document.getElementById('tasksContainer');
        const verificationModal = document.getElementById('verificationModal');
        const completionModal = document.getElementById('completionModal');
        const verificationImagePreview = document.getElementById('verificationImagePreview');
        const verificationPlaceholder = document.getElementById('verificationPlaceholder');
        const verificationImageInput = document.getElementById('verificationImageInput');
        const countdownElement = document.getElementById('countdown');
        const countdownValue = document.getElementById('countdownValue');
        const verifyButton = document.getElementById('verifyButton');
        const completedTasksElement = document.getElementById('completedTasks');
        const statusBadge = document.getElementById('statusBadge');
        const currentUserEmail = document.getElementById('currentUserEmail');
        const googleUserBadge = document.getElementById('googleUserBadge');
        const channelLink = document.getElementById('channelLink');
        const verificationInstructions = document.getElementById('verificationInstructions');

        // State variables
        let currentUser = localStorage.getItem('currentUser') || null;
        let currentUserIsGoogle = localStorage.getItem('currentUserIsGoogle') === 'true' || false;
        let currentTaskId = null;
        let countdownInterval = null;

        // Event listeners
        verificationImageInput.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    verificationImagePreview.src = event.target.result;
                    verificationImagePreview.classList.remove('hidden');
                    verificationPlaceholder.classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        // Google Sign-In Handler
        function handleGoogleSignIn(response) {
            try {
                if (!response || !response.credential) {
                    throw new Error('Invalid Google Sign-In response');
                }

                // Decode the JWT response
                const responsePayload = parseJwt(response.credential);

                if (!responsePayload || !responsePayload.email) {
                    throw new Error('Invalid user data from Google');
                }

                // Store user information
                currentUser = responsePayload.email;
                currentUserIsGoogle = true;

                localStorage.setItem('currentUser', responsePayload.email);
                localStorage.setItem('currentUserIsGoogle', 'true');

                // Check if user exists, if not create account
                const users = JSON.parse(localStorage.getItem('users'));
                const userExists = users.some(user => user.email === responsePayload.email);

                if (!userExists) {
                    users.push({
                        email: responsePayload.email,
                        password: '', // No password for Google users
                        isGoogle: true
                    });
                    localStorage.setItem('users', JSON.stringify(users));
                }

                // Proceed to dashboard
                authContainer.classList.add('hidden');
                dashboardContainer.classList.remove('hidden');
                loadDashboard();
            } catch (error) {
                console.error('Google Sign-In handler error:', error);
                alert('Google Sign-In failed. Please try again or use manual login.');
            }
        }

        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            return JSON.parse(jsonPayload);
        }

        function googleSignIn() {
            try {
                // Trigger Google Sign-In flow
                google.accounts.id.prompt((notification) => {
                    if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                        // Fallback: try to render button click
                        console.log('Google Sign-In prompt not displayed, trying alternative method');
                    }
                });
            } catch (error) {
                console.error('Google Sign-In error:', error);
                alert('Google Sign-In is currently unavailable. Please try manual login.');
            }
        }

        // Navigation functions
        function showSignup() {
            loginForm.classList.add('hidden');
            signupForm.classList.remove('hidden');
        }

        function showLogin() {
            signupForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        }

        // Auth functions
        function signup() {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;

            if (!email || !password || !confirmPassword) {
                alert('Please fill all fields');
                return;
            }

            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users'));
            const userExists = users.some(user => user.email === email);

            if (userExists) {
                alert('User already exists');
                return;
            }

            users.push({ email, password, isGoogle: false });
            localStorage.setItem('users', JSON.stringify(users));

            alert('Account created successfully');
            showLogin();
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('Please fill all fields');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users'));
            const user = users.find(user => user.email === email && (user.password === password || user.isGoogle));

            if (!user) {
                alert('Invalid credentials');
                return;
            }

            if (user.isGoogle) {
                alert('Please sign in with Google');
                return;
            }

            currentUser = email;
            currentUserIsGoogle = false;
            localStorage.setItem('currentUser', email);
            localStorage.setItem('currentUserIsGoogle', 'false');
            authContainer.classList.add('hidden');
            dashboardContainer.classList.remove('hidden');
            loadDashboard();
        }

        function logout() {
            if (currentUserIsGoogle) {
                // Revoke Google access
                google.accounts.id.revoke(currentUser, done => {
                    console.log('Google access revoked');
                });
            }

            currentUser = null;
            currentUserIsGoogle = false;
            localStorage.removeItem('currentUser');
            localStorage.removeItem('currentUserIsGoogle');
            dashboardContainer.classList.add('hidden');
            authContainer.classList.remove('hidden');
            showLogin();
        }

        // Dashboard functions
        function loadDashboard() {
            const tasks = JSON.parse(localStorage.getItem('tasks'));
            tasksContainer.innerHTML = '';
            currentUserEmail.textContent = currentUser;

            if (currentUserIsGoogle) {
                googleUserBadge.classList.remove('hidden');
            } else {
                googleUserBadge.classList.add('hidden');
            }

            let completedCount = 0;
            tasks.forEach(task => {
                if (task.completed) completedCount++;

                const taskCard = document.createElement('div');
                taskCard.className = 'task-card rounded-lg p-4 cursor-pointer';
                if (task.completed) {
                    taskCard.classList.add('opacity-60');
                }
                taskCard.innerHTML = `
                    <h3 class="font-bold text-lg mb-2 text-white">${task.title}</h3>
                    <p class="text-gray-400 mb-4">${task.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs ${task.completed ? 'text-gray-300' : 'text-gray-500'}">
                            ${task.completed ? 'VERIFIED' : 'PENDING'}
                        </span>
                        <button onclick="event.stopPropagation(); openVerificationModal(${task.id})" class="bg-gray-800 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm ${task.completed ? 'hidden' : ''}">
                            VERIFY
                        </button>
                    </div>
                `;
                tasksContainer.appendChild(taskCard);
            });

            completedTasksElement.textContent = completedCount;

            // Eligibility notification after 4 tasks
            if (completedCount === 4) {
                if (!document.getElementById('eligibilityNotification')) {
                    const notification = document.createElement('div');
                    notification.id = 'eligibilityNotification';
                    notification.className = 'fixed bottom-8 right-8 bg-green-700 text-white px-6 py-4 rounded-lg shadow-lg z-50 font-bold text-lg';
                    notification.textContent = 'Congratulations! You are now eligible.';
                    document.body.appendChild(notification);
                    setTimeout(() => {
                        notification.remove();
                    }, 4000);
                }
            }

            if (completedCount === 4) {
                statusBadge.textContent = 'COMPLETED';
                statusBadge.classList.remove('bg-gray-800');
                statusBadge.classList.add('bg-gray-600');
                setTimeout(() => {
                    completionModal.classList.remove('hidden');
                }, 1000);
            }
        }

        // Verification functions
        function openVerificationModal(taskId) {
            currentTaskId = taskId;
            const tasks = JSON.parse(localStorage.getItem('tasks'));
            const task = tasks.find(t => t.id === taskId);

            // Set up the channel link and instructions
            channelLink.href = CHANNEL_URLS[taskId];
            channelLink.textContent = `Go to ${task.title.replace("FOLLOW ON ", "").replace("JOIN ", "").replace("LIKE ", "")}`;

            let instructionText = "";
            switch (taskId) {
                case 1:
                    instructionText = "Subscribe to our YouTube channel and take a screenshot of your subscription";
                    break;
                case 2:
                    instructionText = "Follow us on Twitter/X and take a screenshot of your follow";
                    break;
                case 4:
                    instructionText = "Follow us on Instagram and take a screenshot of your follow";
                    break;
                case 5:
                    instructionText = "Like our Facebook page and take a screenshot of your like";
                    break;
                default:
                    instructionText = "Complete the task and provide verification";
            }
            verificationInstructions.textContent = instructionText;

            document.getElementById('verificationTaskTitle').textContent = `VERIFY: ${task.title}`;
            verificationImagePreview.src = '';
            verificationImagePreview.classList.add('hidden');
            verificationPlaceholder.classList.remove('hidden');
            verificationImageInput.value = '';
            countdownElement.classList.add('hidden');
            verifyButton.disabled = false;
            verifyButton.textContent = 'VERIFY';

            verificationModal.classList.remove('hidden');

            // Open the channel in a new tab
            window.open(CHANNEL_URLS[taskId], '_blank');
        }

        function cancelVerification() {
            clearInterval(countdownInterval);
            verificationModal.classList.add('hidden');
        }

        function startVerification() {
            if (!verificationImageInput.files[0]) {
                alert('Please select an image first');
                return;
            }

            verifyButton.disabled = true;
            verifyButton.textContent = 'VERIFYING...';
            countdownElement.classList.remove('hidden');

            let seconds = 10;
            countdownValue.textContent = seconds;

            countdownInterval = setInterval(() => {
                seconds--;
                countdownValue.textContent = seconds;

                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    completeVerification();
                }
            }, 1000);
        }

        function completeVerification() {
            const tasks = JSON.parse(localStorage.getItem('tasks'));
            const taskIndex = tasks.findIndex(t => t.id === currentTaskId);

            if (taskIndex !== -1) {
                const file = verificationImageInput.files[0];
                const reader = new FileReader();

                reader.onload = function (event) {
                    tasks[taskIndex].completed = true;
                    tasks[taskIndex].verified = true;
                    tasks[taskIndex].image = event.target.result;

                    localStorage.setItem('tasks', JSON.stringify(tasks));

                    verificationModal.classList.add('hidden');
                    loadDashboard();
                };

                reader.readAsDataURL(file);
            }
        }

        // Initialize the app
        window.addEventListener('DOMContentLoaded', () => {
            try {
                // Check if Google Sign-In script is loaded
                if (typeof google === 'undefined' || !google.accounts) {
                    console.error('Google Sign-In script not loaded');
                    return;
                }

                // Initialize Google Sign-In
                google.accounts.id.initialize({
                    client_id: "48508544336-ffr2pdtvlbr0tu93g2eta82ggtk2gtth.apps.googleusercontent.com",
                    callback: handleGoogleSignIn,
                    auto_select: false,
                    cancel_on_tap_outside: true
                });

                // Check if user is logged in
                if (currentUser) {
                    authContainer.classList.add('hidden');
                    dashboardContainer.classList.remove('hidden');
                    loadDashboard();
                }
            } catch (error) {
                console.error('Google Sign-In initialization error:', error);
            }
        });
    </script>
</body>

</html>